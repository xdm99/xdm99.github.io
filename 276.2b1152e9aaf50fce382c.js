"use strict";(self.webpackChunkrareworlds_app=self.webpackChunkrareworlds_app||[]).push([[276],{5187:(W,D,r)=>{r.d(D,{g:()=>l});var P=r(665),m=r(9653),A=r(43),s=r(1785),e=r(639);function x(a,g){if(1&a&&(e.ynx(0),e._UZ(1,"app-geo-filter-item",4),e.BQk()),2&a){const t=g.$implicit;e.xp6(1),e.Q6J("item",t)}}function U(a,g){if(1&a&&(e.TgZ(0,"clr-option",5),e._UZ(1,"app-geo-filter-item",4),e.qZA()),2&a){const t=g.$implicit;e.Q6J("clrValue",t),e.xp6(1),e.Q6J("item",t)}}function o(a,g){if(1&a){const t=e.EpF();e.TgZ(0,"clr-combobox-container"),e.TgZ(1,"clr-combobox",1),e.NdJ("ngModelChange",function(v){return e.CHM(t),e.oxw().selection=v})("clrSelectionChange",function(v){return e.CHM(t),e.oxw().selectionChange(v)}),e.YNc(2,x,2,1,"ng-container",2),e.TgZ(3,"clr-options"),e.YNc(4,U,2,2,"clr-option",3),e.qZA(),e.qZA(),e.qZA()}if(2&a){const t=e.oxw();e.xp6(1),e.Q6J("clrMulti",!0)("ngModel",t.selection),e.xp6(3),e.Q6J("clrOptionItemsOf",t.items)("clrOptionItemsField","name")}}let l=(()=>{class a{constructor(){this.properties=[{property:"landAreaKM2",name:"Land Area"},{property:"waterAreaKM2",name:"Water Area"},{property:"landBiasPercent",name:"Land Bias"},{property:"highestPointFromSeaLevelM",name:"Highest Point"},{property:"lowestPointFromSeaLevelM",name:"Lowest Point"},{property:"annualRainfallMM",name:"Annual Rainfall"}],this.selection=[],this.initItems()}ngOnInit(){}writeValue(t){this.value=t,this.selection=t.values.map(d=>{const[v,u]=d.value.split(":").map(L=>parseInt(L)),T=Object.keys(s.WP)[v-1],h=Object.values(m.VH)[u-1];return this.items.find(L=>L.property===T&&L.rarity===h)})}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}selectionChange({model:t}){this.selection=(0,A.A)(t),this.onChange&&this.onChange(Object.assign(this.value,{values:this.selection.map(({property:d,rarity:v})=>({value:`${s.WP[d]}:${m.H_.get(v)}`,valueOperator:"eq"}))}))}initItems(){const t=Object.values(m.VH).filter(d=>"custom"!==d);this.items=this.properties.reduce((d,v)=>{const{property:u,name:T}=v;return d.push(...t.map(h=>({property:u,name:`${h.replace("_"," ")} ${T}`,rarity:h}))),d},[])}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-geo-filter"]],features:[e._Bn([{provide:P.JU,useExisting:a,multi:!0}])],decls:4,vars:1,consts:[[4,"ngIf"],["placeholder","Geography rarity...","name","features",1,"filter-combobox",3,"clrMulti","ngModel","ngModelChange","clrSelectionChange"],[4,"clrOptionSelected"],[3,"clrValue",4,"clrOptionItems","clrOptionItemsOf","clrOptionItemsField"],[3,"item"],[3,"clrValue"]],template:function(t,d){1&t&&(e.TgZ(0,"div"),e.TgZ(1,"strong"),e._uU(2,"Geography"),e.qZA(),e.qZA(),e.YNc(3,o,5,4,"clr-combobox-container",0)),2&t&&(e.xp6(3),e.Q6J("ngIf",d.items))},styles:[""]}),a})()},43:(W,D,r)=>{r.d(D,{A:()=>o,K:()=>l});var P=r(665),m=r(9653),A=r(2984),s=r(639);function e(a,g){if(1&a&&(s.ynx(0),s._UZ(1,"app-resource-filter-item",4),s.BQk()),2&a){const t=g.$implicit;s.xp6(1),s.Q6J("item",t)}}function x(a,g){if(1&a&&(s.TgZ(0,"clr-option",5),s._UZ(1,"app-resource-filter-item",4),s.qZA()),2&a){const t=g.$implicit;s.Q6J("clrValue",t),s.xp6(1),s.Q6J("item",t)}}function U(a,g){if(1&a){const t=s.EpF();s.TgZ(0,"clr-combobox-container"),s.TgZ(1,"clr-combobox",1),s.NdJ("ngModelChange",function(v){return s.CHM(t),s.oxw().selection=v})("clrSelectionChange",function(v){return s.CHM(t),s.oxw().selectionChange(v)}),s.YNc(2,e,2,1,"ng-container",2),s.TgZ(3,"clr-options"),s.YNc(4,x,2,2,"clr-option",3),s.qZA(),s.qZA(),s.qZA()}if(2&a){const t=s.oxw();s.xp6(1),s.Q6J("clrMulti",!0)("ngModel",t.selection),s.xp6(3),s.Q6J("clrOptionItemsOf",t.items)("clrOptionItemsField","name")}}function o(a){if(a&&a.length>1){const g=a[a.length-1];if(void 0!==g){const t=a.findIndex(d=>d.property===g.property&&d.rarity!==g.rarity);t>-1&&a.splice(t,1)}}return a||[]}let l=(()=>{class a{constructor(){this.properties=[{property:"lumberPercent",name:"Lumber"},{property:"coalPercent",name:"Coal"},{property:"oilPercent",name:"Oil"},{property:"dirtSoilPercent",name:"Dirt"},{property:"commonMetalsPercent",name:"Common Metals"},{property:"rareMetalsPercent",name:"Rare Metals"},{property:"gemstonesPercent",name:"Gemstones"},{property:"freshWaterPercent",name:"Fresh Water"},{property:"saltWaterPercent",name:"Salt Water"}],this.selection=[],this.buildItems()}ngOnInit(){}writeValue(t){this.value=t,this.selection=t.values.map(d=>{const[v,u]=d.value.split(":").map(L=>parseInt(L)),T=Object.keys(A.pr)[v-1],h=Object.values(m.VH)[u-1];return this.items.find(L=>L.property===T&&L.rarity===h)})}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}selectionChange({model:t}){this.selection=o(t),this.onChange&&this.onChange(Object.assign(this.value,{values:this.selection.map(({property:d,rarity:v})=>({value:`${A.pr[d]}:${m.H_.get(v)}`,valueOperator:"eq"}))}))}buildItems(){const t=Object.values(m.VH).filter(d=>"custom"!==d);this.items=this.properties.reduce((d,v)=>{const{property:u,name:T}=v;return d.push(...t.map(h=>({property:u,name:`${h.replace("_"," ")} ${T}`,rarity:h}))),d},[])}}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=s.Xpm({type:a,selectors:[["app-resources-filter"]],features:[s._Bn([{provide:P.JU,useExisting:a,multi:!0}])],decls:4,vars:1,consts:[[4,"ngIf"],["placeholder","Resource rarity...","name","features",1,"filter-combobox",3,"clrMulti","ngModel","ngModelChange","clrSelectionChange"],[4,"clrOptionSelected"],[3,"clrValue",4,"clrOptionItems","clrOptionItemsOf","clrOptionItemsField"],[3,"item"],[3,"clrValue"]],template:function(t,d){1&t&&(s.TgZ(0,"div"),s.TgZ(1,"strong"),s._uU(2,"Resources"),s.qZA(),s.qZA(),s.YNc(3,U,5,4,"clr-combobox-container",0)),2&t&&(s.xp6(3),s.Q6J("ngIf",d.items))},styles:[""]}),a})()},4939:(W,D,r)=>{r.d(D,{G:()=>e});var P=r(8002),m=r(1929),A=r(639),s=r(4889);let e=(()=>{class x{constructor(o,l){this.router=o,this.activatedRoute=l,this.filterBy$=new m.t(1),this.transferFilterData()}transferFilterData(){this.activatedRoute.queryParams.pipe((0,P.U)(this._queryParamsToFilterSet)).subscribe(o=>this.filterBy$.next(o))}setParamsAndNavigate(o){const l=this._filterSetToQueryParams(o);console.log("filterSet",o),console.log("queryParams",l),this.router.navigate([],{relativeTo:this.activatedRoute,queryParams:l})}getFilterSnapshot(){return this._queryParamsToFilterSet(this.activatedRoute.snapshot.queryParams)}_filterSetToQueryParams(o){const l=Object.keys(o).reduce((a,g)=>{const t=o[g];return t&&t.values.length&&(a[g]=t.values.reduce((d,v)=>(d.push(v.value.toString()),d),[]).join(",")),a},{});return"rarity"in l&&"1,10000"===l.rarity&&delete l.rarity,l}_queryParamsToFilterSet(o){const l={};return Object.keys(o).forEach(a=>{switch(a){case"rarity":const[g,t]=o[a].split(",").map(d=>parseInt(d));l[a]={values:[{value:g||1,valueOperator:"gte"},{value:t||1e4,valueOperator:"lte"}],setOperator:"and"};break;case"features":case"biomes":l[a]={values:o[a].split(",").map(d=>({value:parseInt(d),valueOperator:"eq"})),setOperator:"and"};break;case"geography":case"resources":l[a]={values:o[a].split(",").map(d=>({value:d,valueOperator:"eq"})),setOperator:"and"}}}),l}}return x.\u0275fac=function(o){return new(o||x)(A.LFG(s.F0),A.LFG(s.gz))},x.\u0275prov=A.Yz7({token:x,factory:x.\u0275fac}),x})()},1495:(W,D,r)=>{r.d(D,{l:()=>I});const A=["bar-chart",(0,r(2981).h)({outline:'<path d="M32,5H4A2,2,0,0,0,2,7V29a2,2,0,0,0,2,2H32a2,2,0,0,0,2-2V7A2,2,0,0,0,32,5ZM4,29V7H32V29Z"/><path d="M 7 10 L 13 10 L 13 26 L 11.4 26 L 11.4 11.6 L 8.6 11.6 L 8.6 26 L 7 26 Z"/><path d="M 15 19 L 21 19 L 21 26 L 19.4 26 L 19.4 20.6 L 16.6 20.6 L 16.6 26 L 15 26 Z"/><path d="M 23 16 L 29 16 L 29 26 L 27.4 26 L 27.4 17.6 L 24.6 17.6 L 24.6 26 L 23 26 Z"/>',outlineAlerted:'<path d="M 34 29 C 34 30.105 33.105 31 32 31 L 4 31 C 2.895 31 2 30.105 2 29 L 2 7 C 2 5.895 2.895 5 4 5 L 21.958 5 L 20.786 7 L 4 7 L 4 29 L 32 29 L 32 15.357 L 34 15.357 Z"/><path d="M 7 10 L 13 10 L 13 26 L 11.4 26 L 11.4 11.6 L 8.6 11.6 L 8.6 26 L 7 26 Z"/><path d="M 15 19 L 21 19 L 21 26 L 19.4 26 L 19.4 20.6 L 16.6 20.6 L 16.6 26 L 15 26 Z"/><path d="M 23 16 L 29 16 L 29 26 L 27.4 26 L 27.4 17.6 L 24.6 17.6 L 24.6 26 L 23 26 Z"/>',outlineBadged:'<path d="M 32 13.22 L 32 29 L 4 29 L 4 7 L 22.57 7 C 22.524 6.668 22.501 6.334 22.5 6 C 22.501 5.665 22.524 5.331 22.57 5 L 4 5 C 2.895 5 2 5.895 2 7 L 2 29 C 2 30.104 2.895 31 4 31 L 32 31 C 33.105 31 34 30.104 34 29 L 34 12.34 C 33.38 12.73 32.706 13.026 32 13.22 Z"/><path d="M 7 10 L 13 10 L 13 26 L 11.4 26 L 11.4 11.6 L 8.6 11.6 L 8.6 26 L 7 26 Z"/><path d="M 15 19 L 21 19 L 21 26 L 19.4 26 L 19.4 20.6 L 16.6 20.6 L 16.6 26 L 15 26 Z"/><path d="M 23 16 L 29 16 L 29 26 L 27.4 26 L 27.4 17.6 L 24.6 17.6 L 24.6 26 L 23 26 Z"/>',solid:'<path d="M 34 7 L 34 29 C 34 30.105 33.105 31 32 31 L 4 31 C 2.895 31 2 30.105 2 29 L 2 7 C 2 5.895 2.895 5 4 5 L 32 5 C 33.105 5 34 5.895 34 7 Z M 7 26 L 13 26 L 13 10 L 7 10 Z M 15 26 L 21 26 L 21 19 L 15 19 Z M 23 26 L 29 26 L 29 16 L 23 16 Z"/>',solidAlerted:'<path d="M 34 29 C 34 30.105 33.105 31 32 31 L 4 31 C 2.895 31 2 30.105 2 29 L 2 7 C 2 5.895 2.895 5 4 5 L 21.958 5 L 17.625 12.395 C 16.795 13.601 17.594 15.245 19.064 15.351 C 19.134 15.357 19.201 15.359 19.27 15.357 L 34 15.357 Z M 7 26 L 13 26 L 13 10 L 7 10 Z M 15 26 L 21 26 L 21 19 L 15 19 Z M 23 26 L 29 26 L 29 16 L 23 16 Z"/>',solidBadged:'<path d="M 34 12.34 L 34 29 C 34 30.105 33.105 31 32 31 L 4 31 C 2.895 31 2 30.105 2 29 L 2 7 C 2 5.895 2.895 5 4 5 L 22.57 5 C 21.969 9.233 25.05 13.1 29.31 13.46 L 30.32 13.48 C 31.625 13.429 32.895 13.036 34 12.34 Z M 7 26 L 13 26 L 13 10 L 7 10 Z M 15 26 L 21 26 L 21 19 L 15 19 Z M 23 26 L 29 26 L 29 16 L 23 16 Z"/>'})];var s=r(690),e=r(639),x=r(9052),U=r(8465),o=r(1653),l=r(8583),a=r(4889),g=r(2697),t=r(6272),d=r(5818),v=r(3592),u=r(5162);function T(i,E){1&i&&(e.ynx(0),e._uU(1," World Name "),e.BQk())}function h(i,E){1&i&&(e.ynx(0),e._uU(1," Sale Date "),e.BQk())}const L=function(){return{hidden:!1}};function B(i,E){1&i&&(e.TgZ(0,"clr-dg-column"),e.YNc(1,h,2,0,"ng-container",2),e.qZA()),2&i&&(e.xp6(1),e.Q6J("clrDgHideableColumn",e.DdM(1,L)))}function n(i,E){1&i&&(e.ynx(0),e._uU(1," Geography "),e.BQk())}function c(i,E){1&i&&(e.ynx(0),e._uU(1," Resources "),e.BQk())}function C(i,E){1&i&&(e.ynx(0),e._uU(1," Features "),e.BQk())}const f=function(i){return["/world",i]};function y(i,E){if(1&i&&e._UZ(0,"img",12),2&i){const p=e.oxw().$implicit;e.Q6J("routerLink",e.VKq(3,f,p.worldNumber)),e.uIk("src",p.getImageThumbnailUrl(),e.LSH)("alt",p.worldName+"preview image")}}function O(i,E){1&i&&(e.ynx(0),e.TgZ(1,"div"),e._uU(2,"\xa0"),e.qZA(),e.BQk())}function _(i,E){if(1&i&&(e.TgZ(0,"clr-dg-cell"),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const p=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,p.getLastSaleDate())," ")}}function Z(i,E){if(1&i&&(e.TgZ(0,"clr-dg-row"),e.TgZ(1,"clr-dg-cell"),e._uU(2),e.qZA(),e.TgZ(3,"clr-dg-cell"),e.TgZ(4,"a",7),e._uU(5),e.qZA(),e.YNc(6,y,1,5,"img",8),e.qZA(),e.TgZ(7,"clr-dg-cell"),e.TgZ(8,"span"),e._uU(9),e.ALo(10,"number"),e.qZA(),e._UZ(11,"br"),e.TgZ(12,"span",9),e._uU(13," Airdrop"),e.TgZ(14,"sup"),e._uU(15,"approx."),e.qZA(),e._UZ(16,"br"),e._uU(17),e.ALo(18,"number"),e._UZ(19,"br"),e._UZ(20,"br"),e._uU(21," Staking"),e.TgZ(22,"sup"),e._uU(23,"75%"),e.qZA(),e._UZ(24,"br"),e._uU(25),e.ALo(26,"number"),e.qZA(),e.qZA(),e.TgZ(27,"clr-dg-cell"),e._UZ(28,"app-cur-price",10),e.YNc(29,O,3,0,"ng-container",3),e._UZ(30,"app-last-price",10),e.qZA(),e.YNc(31,_,3,3,"clr-dg-cell",3),e.TgZ(32,"clr-dg-cell"),e._UZ(33,"app-geography",11),e.qZA(),e.TgZ(34,"clr-dg-cell"),e._UZ(35,"app-resource-list",11),e.qZA(),e.TgZ(36,"clr-dg-cell"),e._UZ(37,"app-feature-list",11),e.qZA(),e.qZA()),2&i){const p=E.$implicit,M=e.oxw();e.xp6(2),e.Oqu(p.worldNumber),e.xp6(2),e.Q6J("routerLink",e.VKq(28,f,p.worldNumber)),e.xp6(1),e.Oqu(p.worldName),e.xp6(1),e.Q6J("ngIf",""!==p.getImageThumbnailUrl()),e.xp6(3),e.hij("Rank ",e.lcZ(10,22,p.rarityRank),""),e.xp6(8),e.hij("",e.lcZ(18,24,p.tokenAirdropAmount)," $WRLD"),e.xp6(8),e.hij("",e.lcZ(26,26,p.staking75DailyAmount)," $WRLD/day "),e.xp6(3),e.Q6J("world",p)("simple",!0),e.xp6(1),e.Q6J("ngIf",p.saleActive()),e.xp6(1),e.Q6J("world",p)("simple",!0),e.xp6(1),e.Q6J("ngIf",M.user&&M.user.isTester()),e.xp6(2),e.Q6J("compactMode",!0)("rareMode",M.rareMode)("world",p),e.xp6(2),e.Q6J("compactMode",!0)("rareMode",M.rareMode)("world",p),e.xp6(2),e.Q6J("compactMode",!0)("rareMode",M.rareMode)("world",p)}}class R{compare(E,p){return E.worldNumber-p.worldNumber}}let I=(()=>{class i{constructor(p,M){this.service=p,this.userService=M,this.dummyComparator=new R,this.rareMode=!1,this.loading=!0,this.subscribeToData()}ngOnInit(){this.loadIcons()}loadIcons(){s.Q.addIcons(A)}ngOnChanges(p){if("worlds"in p&&p.worlds.isFirstChange()){const M=p.worlds.currentValue;M&&M.length&&this.service.setupWorldsStream(M)}}subscribeToData(){this.service.loading$.subscribe(p=>this.loading=p),this.service.pageContent$.subscribe(p=>{this.pageItems=p,this.loading=!1}),this.userService.currentUser$.subscribe(p=>this.user=p),this.service.totalItems$.subscribe(p=>this.totalItems=p)}onPageChange(p){this.loading=!0,this.service.changePageNumber(p)}sortChanged(p,M){this.loading=!0,this.service.changeSortOrder(p,M)}}return i.\u0275fac=function(p){return new(p||i)(e.Y36(x.f),e.Y36(U.K))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-world-grid"]],inputs:{worlds:"worlds",rareMode:"rareMode"},features:[e.TTD],decls:23,vars:30,consts:[[3,"clrDgLoading"],[3,"clrDgSortBy","clrDgSortOrderChange"],[4,"clrDgHideableColumn"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"clrDgPageSize","clrDgTotalItems","clrDgPageChange"],["pagination",""],[3,"routerLink"],["class","world-preview",3,"routerLink",4,"ngIf"],[1,"token-wrapper"],[3,"world","simple"],[3,"compactMode","rareMode","world"],[1,"world-preview",3,"routerLink"]],template:function(p,M){if(1&p&&(e.TgZ(0,"clr-datagrid",0),e.TgZ(1,"clr-dg-column",1),e.NdJ("clrDgSortOrderChange",function(F){return M.sortChanged("worldNumber",F)}),e._uU(2," World ID "),e.qZA(),e.TgZ(3,"clr-dg-column"),e.YNc(4,T,2,0,"ng-container",2),e.qZA(),e.TgZ(5,"clr-dg-column",1),e.NdJ("clrDgSortOrderChange",function(F){return M.sortChanged("rarityRank",F)}),e._uU(6," Rarity "),e.qZA(),e.TgZ(7,"clr-dg-column"),e._uU(8," Price "),e.qZA(),e.YNc(9,B,2,2,"clr-dg-column",3),e.TgZ(10,"clr-dg-column"),e.YNc(11,n,2,0,"ng-container",2),e.qZA(),e.TgZ(12,"clr-dg-column"),e.YNc(13,c,2,0,"ng-container",2),e.qZA(),e.TgZ(14,"clr-dg-column"),e.YNc(15,C,2,0,"ng-container",2),e.qZA(),e.YNc(16,Z,38,30,"clr-dg-row",4),e.TgZ(17,"clr-dg-footer"),e.TgZ(18,"clr-dg-pagination",5,6),e.NdJ("clrDgPageChange",function(F){return M.onPageChange(F)}),e._uU(20),e.qZA(),e.qZA(),e.TgZ(21,"clr-dg-placeholder"),e._uU(22,"We couldn't find any worlds!"),e.qZA(),e.qZA()),2&p){const b=e.MAs(19);e.Q6J("clrDgLoading",M.loading),e.xp6(1),e.Udp("width",100,"px"),e.Q6J("clrDgSortBy",M.dummyComparator),e.xp6(2),e.Udp("width",100,"px"),e.xp6(1),e.Q6J("clrDgHideableColumn",e.DdM(26,L)),e.xp6(1),e.Udp("width",150,"px"),e.Q6J("clrDgSortBy",M.dummyComparator),e.xp6(2),e.Udp("width",50,"px"),e.xp6(2),e.Q6J("ngIf",M.user&&M.user.isTester()),e.xp6(1),e.Udp("width",200,"px"),e.xp6(1),e.Q6J("clrDgHideableColumn",e.DdM(27,L)),e.xp6(1),e.Udp("width",200,"px"),e.xp6(1),e.Q6J("clrDgHideableColumn",e.DdM(28,L)),e.xp6(2),e.Q6J("clrDgHideableColumn",e.DdM(29,L)),e.xp6(1),e.Q6J("ngForOf",M.pageItems),e.xp6(2),e.Q6J("clrDgPageSize",M.service.pageLimit)("clrDgTotalItems",M.totalItems),e.xp6(2),e.lnq(" ",b.firstItem+1," - ",b.lastItem+1," of ",b.totalItems," worlds ")}},directives:[o.C9t,o.PDs,o.Nh1,o.dml,o.K8c,o.m4W,o.KHL,o._6O,l.O5,l.sg,o.dRQ,o.Ltv,o.F7K,o.Z4N,o.Gcc,o.fv_,o.jND,a.yS,g.j,t.S,d.B,v.n,u.C,a.rH],pipes:[l.JJ,l.uU],styles:["clr-datagrid[_ngcontent-%COMP%]{height:calc(100% - 3rem)}img.world-preview[_ngcontent-%COMP%]{width:4rem;margin-top:.6rem;cursor:pointer}.token-wrapper[_ngcontent-%COMP%]{white-space:nowrap;margin-top:.6rem;display:inline-block;font-size:.5rem}"]}),i})()},8555:(W,D,r)=>{r.d(D,{L:()=>v});var P=r(8583),m=r(1653),A=r(4889),s=r(3134),e=r(9052),x=r(665),U=r(43),o=r(5187),l=r(639);let a=(()=>{class u{constructor(){}ngOnInit(){}getClasses(){const{rarity:h}=this.item;return{"trait-text":!0,["trait-text__"+h]:!0}}}return u.\u0275fac=function(h){return new(h||u)},u.\u0275cmp=l.Xpm({type:u,selectors:[["app-geo-filter-item"]],inputs:{item:"item"},decls:2,vars:2,consts:[[1,"filter-item",3,"ngClass"]],template:function(h,L){1&h&&(l.TgZ(0,"span",0),l._uU(1),l.qZA()),2&h&&(l.Q6J("ngClass",L.getClasses()),l.xp6(1),l.Oqu(L.item.name))},directives:[P.mk],styles:[".filter-item[_ngcontent-%COMP%]{text-transform:capitalize}"]}),u})(),g=(()=>{class u{constructor(){}ngOnInit(){}getClasses(){const{rarity:h}=this.item;return{"trait-text":!0,["trait-text__"+h]:!0}}}return u.\u0275fac=function(h){return new(h||u)},u.\u0275cmp=l.Xpm({type:u,selectors:[["app-resource-filter-item"]],inputs:{item:"item"},decls:2,vars:2,consts:[[1,"filter-item",3,"ngClass"]],template:function(h,L){1&h&&(l.TgZ(0,"span",0),l._uU(1),l.qZA()),2&h&&(l.Q6J("ngClass",L.getClasses()),l.xp6(1),l.Oqu(L.item.name))},directives:[P.mk],styles:[".filter-item[_ngcontent-%COMP%]{text-transform:capitalize}"]}),u})();var t=r(1617),d=r(4939);let v=(()=>{class u{}return u.\u0275fac=function(h){return new(h||u)},u.\u0275mod=l.oAB({type:u}),u.\u0275inj=l.cJS({providers:[e.f,d.G],imports:[[P.ez,m.ZRY,A.Bz,s.M,m.eu2,m.OVS,x.u5,x.UX,m.D8V,m.Evj,t.T]]}),u})();l.B6R(U.K,[P.O5,m.c6t,m.HFh,x.JJ,x.On,m.Iql,g,m.yqN,m.vK$,m.DTD],[]),l.B6R(o.g,[P.O5,m.c6t,m.HFh,x.JJ,x.On,m.Iql,a,m.yqN,m.vK$,m.DTD],[])},9052:(W,D,r)=>{r.d(D,{f:()=>h});var P=r(1929),m=r(6215),A=r(9765),s=r(1571),e=r(5435),x=r(3342),U=r(8002),o=r(9653),l=r(1785),a=r(2984),g=r(4987),t=r(639),d=r(4839),v=r(2970),u=r(4939),T=r(2669);let h=(()=>{class L{constructor(n,c,C,f){this.worldsService=n,this.propRegistry=c,this.urlParams=C,this.alertsService=f,this.defaultSort={},this.defaultFilter={},this.pageLimit=10,this.totalItems$=new P.t(1),this.pageNumber$=new m.X(1),this.sortBy$=new m.X(this.defaultSort),this.filterBy$=new m.X(this.defaultFilter),this.pageContent$=new m.X([]),this.loading$=new A.xQ,this.worlds$=new m.X([]),this.maxPages=1e4/this.pageLimit,this.setDataFromUrlParams()}setDataFromUrlParams(){this.urlParams.filterBy$.subscribe(n=>this.updateFilter(n))}changePageNumber(n){n<1&&(n=1),n>this.maxPages&&(n=this.maxPages),this.pageNumber$.next(n),this.loadWorlds()}changeSortOrder(n,c){this.sortBy$.next({[n]:c}),this.loadWorlds()}loadWorlds(){(0,s.$R)(this.worlds$,this.pageNumber$,this.sortBy$,this.filterBy$).pipe((0,e.h)(([C])=>C&&C.length>0)).pipe((0,x.b)(()=>this.loading$.next(!0)),(0,U.U)(([C,f,y,O])=>{const _=(f-1)*this.pageLimit,Z=_+this.pageLimit,R=C.sort((I,i)=>this.sortWorlds(I,i,y)).filter(I=>this.filterWorlds(I,O));return this.totalItems$.next(R.length),R.slice(_,Z)})).subscribe(C=>this.attachOpenseaData(C))}setupWorldsStream(n){this.worlds$.next(n),this.totalItems$.next(n.length),this.pageNumber$.next(1),this.loadWorlds()}updateFilter(n){this.filterBy$.next(this._sanitizeFilter(n)),this.loadWorlds()}attachOpenseaData(n){this.worldsService.loadAndAppendTokenData(n).subscribe(c=>{this.pageContent$.next(c),this.loading$.next(!1)},c=>{this.pageContent$.next(n),this.loading$.next(!1),this.alertsService.showError(g.LA.errorOpenseaApi,g.Ph.errorOpenseaApi),console.log("err",c)})}sortWorlds(n,c,C){let f=0;const y=Object.keys(C);if(y.length){const O=y[0],_=C[O];"rarityRank"===O?f=n.rarityRank<c.rarityRank?-1*_:_:"worldNumber"===O&&(f=n.worldNumber<c.worldNumber?-1*_:_)}return f}filterWorlds(n,c){return Object.keys(c).reduce((C,f)=>{const y=c[f].values.reduce((O,_)=>{let Z=!0;switch(f){case"features":Z=this._filterByFeature(n,_);break;case"biomes":Z=this._filterByBiome(n,_);break;case"geography":Z=this._filterByGeography(n,{value:this._fetchPopulatedPairIndexValue(_,l.WP),valueOperator:_.valueOperator});break;case"resources":Z=this._filterByResources(n,{value:this._fetchPopulatedPairIndexValue(_,a.pr),valueOperator:_.valueOperator});break;case"rarity":Z=this._filterByRarity(n,_)}return"and"===c[f].setOperator?O&&Z:O||Z},!0);return C&&y},!0)}_filterByFeature(n,c){let C=c.value;return n.features.map(f=>f.idx).includes(C)}_filterByBiome(n,c){let C=c.value;return n.biomes.map(f=>f.idx).includes(C)}_filterByRarity(n,c){return"gte"===c.valueOperator?n.rarityRank>=c.value:n.rarityRank<=c.value}_filterByGeography(n,c){return this._filterByAmountProperty("geography",n,c)}_filterByResources(n,c){return this._filterByAmountProperty("resource",n,c)}_filterByAmountProperty(n,c,C){const[f,y]=C.value.toString().split(":"),_=this._getRarityToQuantiles(f,this.propRegistry.quantiles[n]);let Z=i=>!1,R=i=>!0;const I=c[f].value;switch(y){case o.VH.COMMON:R=i=>i>_[o.VH.UNCOMMON][0]&&i<_[o.VH.UNCOMMON][1];break;case o.VH.UNCOMMON:Z=i=>i<=_[y][0],R=i=>i>=_[y][1]&&i<_[o.VH.RARE];break;case o.VH.RARE:R=i=>i>=_[y]&&i<_[o.VH.VERY_RARE];break;case o.VH.VERY_RARE:R=i=>i>=_[y]&&i<_[o.VH.ULTRA_RARE];break;case o.VH.ULTRA_RARE:R=i=>i>=_[y]&&i<_[o.VH.EXTREMELY_RARE];break;case o.VH.EXTREMELY_RARE:R=i=>i>=_[y]}return Z(I)||R(I)}_getRarityToQuantiles(n,c){return{[o.VH.COMMON]:c[n][1],[o.VH.UNCOMMON]:[c[n][0],c[n][2]],[o.VH.RARE]:c[n][3],[o.VH.VERY_RARE]:c[n][4],[o.VH.ULTRA_RARE]:c[n][5],[o.VH.EXTREMELY_RARE]:c[n][6]}}_fetchPopulatedPairIndexValue(n,c){let[C,f]=n.value.split(":").map(_=>parseInt(_));return(C<1||C>10)&&(C=1),(f<0||f>6)&&(f=0),`${Object.keys(c)[C-1]}:${Object.values(o.VH)[f-1]}`}_sanitizeFilter(n){const c={},f=y=>{let O=parseInt(y.toString());return isNaN(O)&&(O=1),O};return["rarity","biomes","features","resources","geography"].forEach(y=>{y in n&&(c[y]={values:n[y].values.map(({value:O,valueOperator:_})=>({value:O="string"==typeof O?O.includes(":")?O.split(":").map(Z=>f(Z)).join(":"):"1:1":f(O),valueOperator:_})),setOperator:n[y].setOperator})}),c}}return L.\u0275fac=function(n){return new(n||L)(t.LFG(d.R),t.LFG(v.OO),t.LFG(u.G),t.LFG(T.m))},L.\u0275prov=t.Yz7({token:L,factory:L.\u0275fac}),L})()}}]);